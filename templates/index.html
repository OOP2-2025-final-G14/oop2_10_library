
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>å›³æ›¸é¤¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='base-style.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
    .pie-charts {
      display: flex;
      justify-content: center;
      gap: 40px;
      }
    </style>
  </head>
  <body>
    <h1>å›³æ›¸é¤¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>

    <h2>ğŸ“Š åˆ©ç”¨çŠ¶æ³</h2>

    <div class="pie-charts">
      <div>
        <h3>å‡ºç‰ˆç¤¾åˆ¥ è²¸å‡ºå›æ•°</h3>
        <div class="chart-container">
        <canvas id="publisherChart" width="400" height="400"></canvas>
      </div>
    </div>

    <div>
      <h3>åˆ©ç”¨è€… å¹´ä»£åˆ¥ åˆ©ç”¨ç‡</h3>
      <canvas id="ageChart" width="400" height="400"></canvas>
    </div>
  </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // ã€ä¿®æ­£1ã€‘ ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ã®æ”¹å–„
        // tojsonãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é€šã™ã ã‘ã§ã€æ­£ã—ã„JSé…åˆ—([ "A", "B" ])ã«ãªã‚Šã¾ã™ã€‚
        // ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã£ãŸã‚Šã€splitã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
          const publisher_labels = '{{ publisher_labels | tojson }}'.replace(/&quot;/g, '"').slice(1, -1).split(',');
          const publisher_data = `{{ publisher_values | tojson }}`.replace(/&quot;/g, '"').slice(1, -1).split(',').map(Number);

        // ã‚°ãƒ©ãƒ•ã®æç”»è¨­å®š
        const ctx = document.getElementById('publisherChart').getContext('2d');
        
        const publisherChart = new Chart(ctx, {
            type: 'pie', 
            // ã€ä¿®æ­£2ã€‘ ã“ã“ã‹ã‚‰ä¸‹ã®ã‚­ãƒ¼åã¯Chart.jsã®ä»•æ§˜é€šã‚Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
            data: {  // Ã— publisher_data â†’ â—‹ data
                labels: publisher_labels, // Ã— publisher_labels â†’ â—‹ labels
                datasets: [{
                    label: 'ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ',
                    data: publisher_data, // Ã— publisher_data â†’ â—‹ data
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(153, 102, 255, 0.7)',
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'å‡ºç‰ˆç¤¾ãƒ©ãƒ³ã‚­ãƒ³ã‚°(ä¸Šä½5ä½)'
                    }
                }
            }
        });
    </script>


    <script>
      const ageLabels = JSON.parse('{{ age_labels | tojson | safe }}');
      const ageValues = JSON.parse('{{ age_values | tojson | safe }}');

      new Chart(document.getElementById('ageChart'), {
        type: 'pie',
        data: {
          labels: ageLabels,
          datasets: [{
            label: 'åˆ©ç”¨å›æ•°',
            data: ageValues
          }]
        },
        options: {
          responsive: false
        }
      });
    </script>


    <h3>æœ¬ã”ã¨ã® è²¸å‡ºå›æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
    <canvas id="bookChart" width="800" height="400"></canvas>

    <script>
      const bookLabels = JSON.parse('{{ book_labels | tojson | safe }}');
      const bookValues = JSON.parse('{{ book_values | tojson | safe }}');

      new Chart(document.getElementById('bookChart'), {
        type: 'bar',
        data: {
          labels: bookLabels,
          datasets: [{
            label: 'è²¸å‡ºå›æ•°',
            data: bookValues
          }]
        }
      });
    </script>

    <hr />

    <h2>ğŸ“ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
    <ul>
      <li><a href="{{ url_for('user.list') }}">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</a></li>
      <li><a href="{{ url_for('book.list') }}">æœ¬ã®ç™»éŒ²</a></li>
      <li><a href="{{ url_for('borrow.list') }}">æœ¬ã®è²¸ã—å‡ºã—ãƒ»è¿”å´</a></li>
      <li><a href="{{ url_for('publisher.list') }}">å‡ºç‰ˆç¤¾ç®¡ç†</a></li>
    </ul>


    
  </body>
</html>
